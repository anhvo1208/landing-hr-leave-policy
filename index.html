<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J77 HR - Futuristic Leave Policy & AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #0066ff;
            --bg-deep: #020617;
            --glass: rgba(15, 23, 42, 0.7);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #e2e8f0;
            overflow-x: hidden;
            margin: 0;
        }

        /* Ambient Background Effects */
        .glow-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #020617 100%);
        }

        .ambient-light {
            position: fixed;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0, 242, 255, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            pointer-events: none;
        }

        /* Waves Animation */
        .wave-container {
            position: fixed;
            bottom: -10%;
            left: -10%;
            width: 120%;
            height: 50%;
            z-index: -1;
            opacity: 0.3;
            pointer-events: none;
        }

        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(transparent, var(--secondary));
            border-radius: 43%;
            animation: rotate 20s linear infinite;
        }

        .wave:nth-child(2) { animation-duration: 25s; opacity: 0.5; border-radius: 40%; }
        .wave:nth-child(3) { animation-duration: 30s; opacity: 0.2; border-radius: 45%; }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Glass Cards */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-card:hover {
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.15);
            transform: translateY(-5px);
        }

        /* Floating Robot */
        #robot-container {
            position: fixed;
            right: 5%;
            top: 20%;
            width: 180px;
            z-index: 50;
            animation: floating 4s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(0, 242, 255, 0.3));
            cursor: pointer;
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0) rotate(2deg); }
            50% { transform: translateY(-20px) rotate(-2deg); }
        }

        .robot-eye { animation: blink 5s infinite; }
        @keyframes blink {
            0%, 95%, 100% { transform: scaleY(1); }
            97% { transform: scaleY(0.1); }
        }

        .hr-chest-glow {
            animation: pulse-hr 2s infinite alternate;
            fill: #00f2ff;
            font-weight: 800;
            font-size: 14px;
        }

        /* AI Chat Window */
        #ai-chat-window {
            position: fixed;
            bottom: 100px;
            right: 5%;
            width: 350px;
            height: 500px;
            z-index: 100;
            display: none;
            flex-direction: column;
            border: 1px solid var(--primary);
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.2);
        }

        /* Particles */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
        }

        /* Nav Item Active */
        .nav-item.active {
            color: var(--primary);
            background: rgba(0, 242, 255, 0.1);
            border-left: 4px solid var(--primary);
        }

        /* Loading Spinner */
        .spinner {
            border: 2px solid rgba(0, 242, 255, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <!-- Background Elements -->
    <div class="glow-bg"></div>
    <div class="ambient-light" style="top: -100px; left: -100px;"></div>
    <div class="ambient-light" style="bottom: -100px; right: -100px;"></div>
    <div class="wave-container">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    <canvas id="particle-canvas"></canvas>

    <!-- AI Robot (Click to Chat) -->
    <div id="robot-container" onclick="toggleChat()">
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <line x1="100" y1="50" x2="100" y2="30" stroke="#00f2ff" stroke-width="3" />
            <circle cx="100" cy="25" r="5" fill="#00f2ff"><animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite" /></circle>
            <rect x="60" y="50" width="80" height="70" rx="30" fill="#1e293b" stroke="#00f2ff" stroke-width="2" />
            <rect x="70" y="65" width="60" height="35" rx="15" fill="#020617" />
            <circle class="robot-eye" cx="85" cy="82" r="4" fill="#00f2ff" />
            <circle class="robot-eye" cx="115" cy="82" r="4" fill="#00f2ff" />
            <path d="M70 120 L130 120 L140 170 L60 170 Z" fill="#1e293b" stroke="#00f2ff" stroke-width="2" />
            <rect x="80" y="135" width="40" height="20" rx="4" fill="rgba(0,242,255,0.1)" />
            <text x="100" y="150" text-anchor="middle" class="hr-chest-glow">HR</text>
            <path d="M70 130 Q50 140 55 160" fill="none" stroke="#00f2ff" stroke-width="2" />
            <path d="M130 130 Q150 140 145 160" fill="none" stroke="#00f2ff" stroke-width="2" />
        </svg>
        <div class="absolute -top-4 -right-4 bg-red-500 text-white text-[10px] px-2 py-1 rounded-full animate-bounce">AI ONLINE</div>
    </div>

    <!-- AI Chat Window -->
    <div id="ai-chat-window" class="glass-card rounded-2xl overflow-hidden flex flex-col">
        <div class="p-4 bg-cyan-600/20 border-b border-cyan-500/30 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-sm font-bold text-cyan-400">✨ HR Bot Assistant</span>
            </div>
            <button onclick="toggleChat()" class="text-gray-400 hover:text-white">✕</button>
        </div>
        <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 text-sm">
            <div class="bg-blue-600/20 p-3 rounded-lg border border-blue-500/20 text-gray-300">
                Xin chào! Tôi là trợ lý AI. Bạn muốn biết gì về chính sách nghỉ phép của J77 không?
            </div>
        </div>
        <div class="p-4 border-t border-white/5 bg-black/20">
            <div class="flex gap-2">
                <input id="chat-input" type="text" placeholder="Hỏi tôi bất cứ điều gì..." class="flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-cyan-500 text-white">
                <button onclick="askAI()" class="bg-cyan-600 hover:bg-cyan-500 px-3 py-2 rounded-lg transition-colors">
                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Sidebar -->
    <nav class="fixed left-0 top-0 h-full w-20 lg:w-64 glass-card border-r border-white/10 z-40 hidden md:flex flex-col py-8 items-center lg:items-start px-4">
        <div class="mb-12 flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-cyan-500 flex items-center justify-center shadow-[0_0_15px_#00f2ff]">
                <span class="font-bold text-white">J77</span>
            </div>
            <span class="hidden lg:block font-bold text-xl tracking-wider text-cyan-400 uppercase">Leave Hub</span>
        </div>
        
        <div class="flex-1 w-full space-y-2">
            <a href="#intro" class="nav-item group flex items-center gap-4 p-3 rounded-lg hover:bg-white/5 transition-all text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <span class="hidden lg:block text-sm font-medium">Tổng Quan</span>
            </a>
            <a href="#annual-leave" class="nav-item group flex items-center gap-4 p-3 rounded-lg hover:bg-white/5 transition-all text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                <span class="hidden lg:block text-sm font-medium">Phép Năm</span>
            </a>
            <a href="#ai-tools" class="nav-item group flex items-center gap-4 p-3 rounded-lg hover:bg-white/5 transition-all text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                <span class="hidden lg:block text-sm font-medium">Công cụ AI ✨</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="md:ml-20 lg:ml-64 p-6 lg:p-12 max-w-7xl mx-auto">
        
        <header id="intro" class="mb-16">
            <div class="inline-block px-4 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/20 text-cyan-400 text-xs font-bold tracking-widest uppercase mb-4">Chính sách 2024</div>
            <h1 class="text-4xl lg:text-6xl font-extrabold mb-6 tracking-tight leading-tight">
                Hệ Thống <br/>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600 italic">Quản Lý Nghỉ Phép</span>
            </h1>
        </header>

        <!-- AI Tools Section -->
        <section id="ai-tools" class="mb-20">
            <div class="flex items-center gap-4 mb-8">
                <div class="h-px flex-1 bg-gradient-to-r from-purple-500/50 to-transparent"></div>
                <h2 class="text-2xl font-bold tracking-widest uppercase text-purple-400">Công cụ AI ✨</h2>
            </div>
            
            <div class="glass-card p-8 rounded-2xl border-purple-500/30">
                <h3 class="text-xl font-bold mb-4 text-white">✨ Kiểm tra kế hoạch nghỉ phép</h3>
                <p class="text-gray-400 mb-6 text-sm">Nhập kế hoạch của bạn, AI sẽ đối chiếu với chính sách J77 để tư vấn.</p>
                <div class="space-y-4 max-w-xl">
                    <textarea id="ai-plan-input" rows="3" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-sm text-white focus:outline-none focus:border-purple-500" placeholder="Ví dụ: Tôi muốn nghỉ 5 ngày phép năm từ thứ 2 tuần sau..."></textarea>
                    <button onclick="analyzePlan()" id="analyze-btn" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 px-6 py-3 rounded-xl font-bold text-sm flex items-center gap-2 transition-all shadow-lg shadow-purple-500/20">
                        <span>✨ Phân tích kế hoạch</span>
                        <div id="analyze-spinner" class="spinner hidden"></div>
                    </button>
                    <div id="plan-result" class="hidden p-4 rounded-xl bg-white/5 border border-white/10 text-gray-300 text-sm italic"></div>
                </div>
            </div>
        </section>

        <!-- Annual Leave Details -->
        <section id="annual-leave" class="mb-20">
            <div class="flex items-center gap-4 mb-8">
                <div class="h-px flex-1 bg-gradient-to-r from-cyan-500/50 to-transparent"></div>
                <h2 class="text-2xl font-bold tracking-widest uppercase text-cyan-400">Chính sách chi tiết</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass-card p-8 rounded-2xl">
                    <h4 class="text-xl font-bold mb-4 text-white">Phép năm tiêu chuẩn</h4>
                    <p class="text-gray-400 leading-relaxed">Nhân viên J77 được hưởng 12 ngày phép/năm. Thử việc 02 tháng không được dùng phép, nhưng sẽ được cộng dồn sau khi ký hợp đồng chính thức.</p>
                </div>
                <div class="glass-card p-8 rounded-2xl">
                    <h4 class="text-xl font-bold mb-4 text-white">Chuyển phép năm</h4>
                    <p class="text-gray-400 leading-relaxed">Số ngày phép dư có thể chuyển sang năm sau nhưng giới hạn thời gian sử dụng đến hết ngày <span class="text-cyan-400 font-bold">31/03</span> hàng năm.</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        const apiKey = ""; // API Key will be injected at runtime
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'j77-leave-policy';

        // Toggle Chat Window
        function toggleChat() {
            const chat = document.getElementById('ai-chat-window');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
        }

        // --- GEMINI API CALL (EXPONENTIAL BACKOFF) ---
        async function callGemini(prompt, systemPrompt) {
            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });
                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (error) {
                    if (i === 4) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // --- FEATURE 1: AI ADVISOR CHAT ---
        async function askAI() {
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');
            const query = input.value.trim();
            if (!query) return;

            // Add user message
            messages.innerHTML += `<div class="ml-8 bg-cyan-600/10 p-3 rounded-lg border border-cyan-500/10 text-white text-right">${query}</div>`;
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            const systemPrompt = `Bạn là trợ lý HR của J77 English Company. 
            Dựa trên chính sách: 
            - 12 ngày phép năm. 
            - Kết hôn: 3 ngày, Con kết hôn: 1 ngày, Tứ thân phụ mẫu mất: 3 ngày (có lương).
            - Nghỉ trên 3 ngày báo trước 1 tuần.
            - Phép dư hết hạn 31/03.
            Trả lời ngắn gọn, lịch sự, chuyên nghiệp.`;

            const loadingId = Date.now();
            messages.innerHTML += `<div id="l-${loadingId}" class="mr-8 bg-blue-600/20 p-3 rounded-lg text-gray-400">Đang suy nghĩ...</div>`;

            try {
                const answer = await callGemini(query, systemPrompt);
                document.getElementById(`l-${loadingId}`).innerHTML = answer;
            } catch (err) {
                document.getElementById(`l-${loadingId}`).innerHTML = "Rất tiếc, tôi gặp sự cố kết nối. Hãy thử lại sau.";
            }
            messages.scrollTop = messages.scrollHeight;
        }

        // --- FEATURE 2: PLAN ANALYZER ---
        async function analyzePlan() {
            const input = document.getElementById('ai-plan-input').value.trim();
            const resultDiv = document.getElementById('plan-result');
            const btn = document.getElementById('analyze-btn');
            const spinner = document.getElementById('analyze-spinner');

            if (!input) return;

            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = "✨ AI đang phân tích kế hoạch của bạn...";
            spinner.classList.remove('hidden');

            const systemPrompt = `Bạn là chuyên gia tư vấn tuân thủ nội bộ. 
            Phân tích kế hoạch nghỉ phép của nhân viên. Kiểm tra xem có vi phạm:
            1. Thời gian báo trước (Nghỉ > 3 ngày báo trước 1 tuần).
            2. Loại phép (AL, PL, SL).
            Nếu hợp lệ, hãy chúc họ có kỳ nghỉ vui vẻ. Nếu không, hãy nhắc nhở nhẹ nhàng.`;

            try {
                const analysis = await callGemini(input, systemPrompt);
                resultDiv.innerHTML = `<div class="text-cyan-400 font-bold mb-2">Kết quả phân tích:</div>${analysis}`;
            } catch (err) {
                resultDiv.innerHTML = "Không thể phân tích lúc này. Vui lòng kiểm tra lại.";
            } finally {
                spinner.classList.add('hidden');
            }
        }

        // --- PARTICLES & DECORATION ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 1;
                this.speedX = Math.random() * 0.4 - 0.2;
                this.speedY = Math.random() * 0.4 - 0.2;
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                if (this.x > canvas.width) this.x = 0; if (this.y > canvas.height) this.y = 0;
            }
            draw() {
                ctx.fillStyle = 'rgba(0, 242, 255, 0.3)';
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
            }
        }
        for (let i = 0; i < 40; i++) particles.push(new Particle());
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // Chat Input Enter Key
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') askAI();
        });
    </script>
</body>
</html>
